<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Growth in a test tube - COMETS Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/extra.css]" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Growth in a test tube";
    var mkdocs_page_input_path = "python-module/1_simple_growth.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> COMETS Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../capabilities/">Capabilities</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMETS PYTHON TOOLBOX</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting_started/">Getting started</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Growth in a test tube</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#loading-the-comets-python-toolbox">Loading the COMETS Python Toolbox</a></li>
    

    <li class="toctree-l3"><a href="#creating-a-test-tube">Creating a test tube</a></li>
    

    <li class="toctree-l3"><a href="#loading-a-model">Loading a model</a></li>
    

    <li class="toctree-l3"><a href="#setting-the-simulation-parameters">Setting the simulation parameters</a></li>
    

    <li class="toctree-l3"><a href="#running-the-simulation">Running the simulation</a></li>
    

    <li class="toctree-l3"><a href="#analyzing-the-results">Analyzing the results</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../2_competition/">Competition assay</a>
                </li>
                <li class="">
                    
    <a class="" href="../3_chemostat/">Continuous culture</a>
                </li>
                <li class="">
                    
    <a class="" href="../4_evolution/">Simulating evolution with COMETS</a>
                </li>
                <li class="">
                    
    <a class="" href="../5_citrate/">Citrate use in the LTEE</a>
                </li>
                <li class="">
                    
    <a class="" href="../6_extracell_rxns/">Extracellular reactions</a>
                </li>
                <li class="">
                    
    <a class="" href="../7_colony.md">Bacterial colony growth</a>
                </li>
                <li class="">
                    
    <a class="" href="../8_demographic/">Demographic noise and cooperative propagation in space</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMETS MATLAB TOOLBOX</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../colony/">Growth of an E. coli colony</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMMAND LINE</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../getting-started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../../interacting.md">Interacting with comets</a>
                </li>
                <li class="">
                    
    <a class="" href="../../layout-files/">Layout Files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../creating-layout/">Creating a Layout</a>
                </li>
                <li class="">
                    
    <a class="" href="../../model-files/">Model Files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../parameters/">Parameters</a>
                </li>
                <li class="">
                    
    <a class="" href="../../single_species/">1. Single species growth</a>
                </li>
                <li class="">
                    
    <a class="" href="../../multi_species/">2. Multi-species growth</a>
                </li>
                <li class="">
                    
    <a class="" href="../../chemostat/">3. Continuous growth in a chemostat</a>
                </li>
                <li class="">
                    
    <a class="" href="../../petri/">4. Colonies on a virtual Petri-dish</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">GRAPHICAL USER INTERFACE</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../colony/">Growth of an E. coli colony</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEGACY DOCUMENTATION</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../legacy-documentation/">Legacy Documentation</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">COMETS Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>COMETS PYTHON TOOLBOX &raquo;</li>
        
      
    
    <li>Growth in a test tube</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>This simple example illustrates the basic workflow of COMETS, including how to
build the simulation layout, to specify parameters, load the model and plot the
data once the simulation is finished.</p>
<p>The core of the COMETS methodology is the Dynamic Flux Balance Analysis
algorithm (Madahevan et al 2002). One of the first successful simulations of
the time dynamics of bacterial metabolism was the classical study of
<em>Escherichia coli</em> batch culture by Varma and Palsson (1994). Here, we reproduce
one of the results in that study, the anaerobic fermentation in minimal media
with glucose as the only carbon source.</p>
<p>We will simulate a test tube by setting a well-mixed virtual container with
<span><span class="MathJax_Preview">1cm^3</span><script type="math/tex">1cm^3</script></span> of media, which we will inoculate with 5e-6 grams of <em>E. coli</em> biomass.
We will set the initial composition of the substrate to 11mM of glucose and
unlimited amounts of ammonia and phosphate. For the nutrient uptake, we will use
standard Michaelis-Menten kinetics, using the experimentally measured Monod
parameter for anaerobic uptake of glucose by <em>E. coli</em>.</p>
<p>For this simple example, we use the rudimentary "core" model of E. coli
(Orth et al. 2009), which can be downloaded in .xml format from
http://bigg.ucsd.edu/models/e_coli_core, and represents an <em>E. coli</em> metabolism
simplified to its core functions (glycolysis, tricarboxylic cycle, pentose
  phosphate shunt, etc).</p>
<h3 id="loading-the-comets-python-toolbox">Loading the COMETS Python Toolbox</h3>
<p>We first import the COMETS Python toolbox, which will also load all the
dependencies, such as CobraPy or pandas.</p>
<pre><code class="Python">import comets as c
</code></pre>

<h3 id="creating-a-test-tube">Creating a test tube</h3>
<p>We are now ready to create a "layout" for our simulation. By instantiating the
class <code>layout</code> without arguments, we will create the default simulation layout,
represents an empty, well mixed space (called "cell") with volume 1cm^3. We can
then modify this layout according to our needs, in this case adding the media
composition in the desired concentration.</p>
<pre><code class="Python"># Create empty 1x1 layout
test_tube = c.layout()

# Add 11mM glucose and remove o2
test_tube.set_specific_metabolite('glc__D_e', 0.011)
test_tube.set_specific_metabolite('o2_e', 0)

# Add the rest of nutrients unlimited (ammonia, phosphate, water and protons)
test_tube.set_specific_metabolite('nh4_e',1000);
test_tube.set_specific_metabolite('pi_e',1000);
test_tube.set_specific_metabolite('h2o_e',1000);
test_tube.set_specific_metabolite('h_e',1000);
</code></pre>

<h3 id="loading-a-model">Loading a model</h3>
<p>Next, we have to load the model and add it to the layout (or "inoculate it in
our test tube").</p>
<p>Under the hood, the comets <code>model</code> class uses the CobraPy package to load
models, and actually comets <code>model</code> class can be instantiated also with a loaded
CobraPy model as input. In our experience, this has been very useful when using
CobraPy and COMETS back and forth to perform different types of simulations and
analysis.</p>
<p>In this case, we load our model from the <code>.xml</code> file we downloaded.
We then remove the boundson glucose import, which will be set dynamically by
COMETS during the simulation according to the dynamically changing external
glucose concentration. We will set the initial biomass of our model at 10-6 gr.  </p>
<pre><code class="Python"># load the model
e_coli = c.model('test_models/e_coli_core.xml')
e_coli.change_bounds('EX_glc__D_e', -1000, 1000)

# set its initial biomass, 5e-6 gr at coordinate [0,0]
e_coli.initial_pop = [0, 0, 5e-6]

# add it to the test_tube
test_tube.add_model(e_coli)
</code></pre>

<h3 id="setting-the-simulation-parameters">Setting the simulation parameters</h3>
<p>We netx instantiate the <code>params</code> class, which generates a set of parameters for
the COMETS simulation with the [TODO LINK TO DEF VALS] default values for all of them. All
of the parameters are contained in the <code>all_params</code> field which is a Python
<code>dict</code> object, making it easy to change the value of the desired parameters.</p>
<pre><code class="Python">
# Set the parameters that are different from the default
sim_params = c.params()
sim_params.all_params['defaultVmax'] = 18.5
sim_params.all_params['defaultKm'] = 0.000015
sim_params.all_params['maxCycles'] = 1000
sim_params.all_params['timeStep'] = 0.01
sim_params.all_params['spaceWidth'] = 1
sim_params.all_params['maxSpaceBiomass'] = 10
sim_params.all_params['minSpaceBiomass'] = 1e-11
sim_params.all_params['writeMediaLog'] = True
</code></pre>

<h3 id="running-the-simulation">Running the simulation</h3>
<p>With all set up, we can now instantiate the <code>comets</code> class by passing the
<code>layout</code> (containing the <code>model</code>) and the <code>params</code> objects we just created.</p>
<pre><code class="Python">well_mixed = c.comets(test_tube, sim_params)
</code></pre>

<p>Finally, we can run the simulation as:</p>
<pre><code class="Python">well_mixed.run()
</code></pre>

<h3 id="analyzing-the-results">Analyzing the results</h3>
<p>The results of our simulation are stored in several <code>pandas</code> data frames
contained in the <code>comets</code> object that we just simulated. The growth of the
simulated model can be seen by plotting the total_biomass field.  </p>
<pre><code class="Python">well_mixed.total_biomass.plot(x = 'cycle')
</code></pre>

<p><img alt="png" src="/img/well_mixed_1.png" /></p>
<p>Similarly, we can plot composition of the media. In this case, we will limit
the plot to those components that are not added to the layout in unlimited
amounts (“static” compounds, e.g. ammonia, phosphate, water, etc in this
  simulation). In this case, we do this by limiting the plot to compounds with
  concentration lower than 900mM.</p>
<pre><code class="Python">media = well_mixed.media.copy()
media = media[media.conc_mmol&lt;900]

fig, ax = plt.subplots()
media.groupby('metabolite').plot(x='cycle', ax =ax, y='conc_mmol')
ax.legend(('acetate','ethanol', 'formate', 'glucose'))
</code></pre>

<p><img alt="png" src="/img/well_mixed_2.png" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../2_competition/" class="btn btn-neutral float-right" title="Competition assay">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../getting_started/" class="btn btn-neutral" title="Getting started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../getting_started/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../2_competition/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/extra.js" defer></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="../../mathjax-config.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
