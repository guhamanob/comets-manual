<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Continuous culture - COMETS Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/extra.css]" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Continuous culture";
    var mkdocs_page_input_path = "python-module/3_chemostat.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> COMETS Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../capabilities/">Capabilities</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMETS PYTHON TOOLBOX</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting_started/">Getting started</a>
                </li>
                <li class="">
                    
    <a class="" href="../1_simple_growth/">Growth in a test tube</a>
                </li>
                <li class="">
                    
    <a class="" href="../2_competition/">Competition assay</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Continuous culture</a>
    <ul class="subnav">
            
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../4_evolution/">Simulating evolution with COMETS</a>
                </li>
                <li class="">
                    
    <a class="" href="../5_citrate/">Citrate use in the LTEE</a>
                </li>
                <li class="">
                    
    <a class="" href="../6_extracell_rxns/">Extracellular reactions</a>
                </li>
                <li class="">
                    
    <a class="" href="../7_colony.md">Bacterial colony growth</a>
                </li>
                <li class="">
                    
    <a class="" href="../8_demographic/">Demographic noise and cooperative propagation in space</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMETS MATLAB TOOLBOX</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../colony/">Growth of an E. coli colony</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMMAND LINE</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../getting-started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../../interacting.md">Interacting with comets</a>
                </li>
                <li class="">
                    
    <a class="" href="../../layout-files/">Layout Files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../creating-layout/">Creating a Layout</a>
                </li>
                <li class="">
                    
    <a class="" href="../../model-files/">Model Files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../parameters/">Parameters</a>
                </li>
                <li class="">
                    
    <a class="" href="../../single_species/">1. Single species growth</a>
                </li>
                <li class="">
                    
    <a class="" href="../../multi_species/">2. Multi-species growth</a>
                </li>
                <li class="">
                    
    <a class="" href="../../chemostat/">3. Continuous growth in a chemostat</a>
                </li>
                <li class="">
                    
    <a class="" href="../../petri/">4. Colonies on a virtual Petri-dish</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">GRAPHICAL USER INTERFACE</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../colony/">Growth of an E. coli colony</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEGACY DOCUMENTATION</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../legacy-documentation/">Legacy Documentation</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">COMETS Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>COMETS PYTHON TOOLBOX &raquo;</li>
        
      
    
    <li>Continuous culture</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>COMETS provides the functionality to run simulations in a chemostat. Here we
are going to simulate a chemostat with lactose as the sole carbon resource and
two strains of E. coli: one which is deficient in the ability to uptake
lactose, and one which is deficient in the ability to metabolize galactose.
We will use the ijo1366 model provided as part of cobrapy.</p>
<p>We will illustrate two ways in which chemostat simulations can be performed
using the Comets Python toolbox: 1) by manually assigning all the "parts," and
2) by using a helper function that is included.</p>
<p>Let's load that first, make a copy, then knock-out the relevant reactions.</p>
<pre><code class="Python">import cobra
import cobra.test
import comets as c

E_no_galE = cobra.test.create_test_model('ecoli') # this model will have galE KO'd
E_no_LCTStex = E_no_galE.copy() # here we'll KO lactose uptake
</code></pre>

<p>Note that the first model had galE knocked out to prevent metabolism of
galactose, which will cause it to be secreted. The second model has a reaction
knocked out instead of a gene, as lactose transport to the periplasm can be
accomplished with multiple genes, and it is simpler to just knockout the
reaction itself.</p>
<p>We can test that the knockouts perform as expected by trying to grow them in
media containing lactose and galactose:</p>
<pre><code class="Py">medium = E_no_galE.medium
medium[&quot;EX_glc_e&quot;] = 0.
medium[&quot;EX_lcts_e&quot;] = 1.
medium[&quot;EX_gal_e&quot;] = 1.

# medium:
{'EX_ca2_e': 1000.0,
'EX_cbl1_e': 0.01,
'EX_cl_e': 1000.0,
'EX_co2_e': 1000.0,
'EX_cobalt2_e': 1000.0,
'EX_cu2_e': 1000.0,
'EX_fe2_e': 1000.0,
'EX_fe3_e': 1000.0,
'EX_gal_e': 1.0,
'EX_h_e': 1000.0,
'EX_h2o_e': 1000.0,
'EX_k_e': 1000.0,
'EX_lcts_e': 1.0,
'EX_mg2_e': 1000.0,
'EX_mn2_e': 1000.0,
'EX_mobd_e': 1000.0,
'EX_na1_e': 1000.0,
'EX_nh4_e': 1000.0,
'EX_ni2_e': 1000.0,
'EX_o2_e': 1000.0,
'EX_pi_e': 1000.0,
'EX_sel_e': 1000.0,
'EX_slnt_e': 1000.0,
'EX_so4_e': 1000.0,
'EX_tungs_e': 1000.0,
'EX_zn2_e': 1000.0,
'EX_glc_e': 0.0}

E_no_galE.medium = medium
E_no_LCTStex.medium = medium

# running the below functions shows growth in each case, but only using
# lactose in the first case and only using galactose in the second case.
# Additionally, we see that E_no_galE secretes galactose during growth on lactose.
E_no_galE.summary()
E_no_LCTStex.summary()
</code></pre>

<p>Now we are ready to setup a COMETS simulation. Let's intend that the medium
shown above is the reservoir (except that we will remove the galactose first),
and the input rate and output rate are 10% / hr. Let's set that parameter and
make our COMETS models.</p>
<pre><code class="Py"># chemostat parameters:
dilution_rate = 0.1 # / hr
initial_pop = 1e-3

# Make the models into COMETS models:
E_no_galE.id = &quot;galE_KO&quot;
E_no_LCTStex.id = &quot;LCTStex_KO&quot;

E_no_galE = c.model(E_no_galE)
E_no_galE.initial_pop = [0, 0, initial_pop]

# next line allows medium to constrain uptake
E_no_galE.reactions.loc[E_no_galE.reactions.EXCH, 'LB'] = -1000

E_no_LCTStex = c.model(E_no_LCTStex)
E_no_LCTStex.initial_pop = [0, 0, initial_pop]

# next line allows medium to constrain uptake
E_no_LCTStex.reactions.loc[E_no_LCTStex.reactions.EXCH, 'LB'] = -1000
Now we are going to use the manual method for making a chemostat. Recall that
Cobra mediums are set using exchange reaction ids, whereas COMETS media are
set using metabolite ids. We can easily take care of this with a dictionary
comprehension. Here we do that, then generate a layout, and add to it the
medium.

# setup layout
comets_media = {key[3:] : value for key, value in medium.items() if key != &quot;EX_gal_e&quot;}
layout = c.layout([E_no_galE, E_no_LCTStex])

# set initial media
for key, value in comets_media.items():
layout.set_specific_metabolite(key, value)
</code></pre>

<p>The input of fresh media from the reservoir into the simulation is done using
media_refresh. Metabolites with a media_refresh value are replenished at the
specified amount per-hour. Since we are diluting at 0.1 per hour, we multiply
the reservoir concentration by this rate.</p>
<pre><code class="Py"># set metabolite drip
for key, value in comets_media.items():
layout.set_specific_refresh(key, value * dilution_rate)
</code></pre>

<p>The rest of the chemostat—the output flow—is setup in the parameters using the
metaboliteDilutionRate and deathRate parameters, which should be set equal to
our dilution rate:</p>
<pre><code class="Py">params = c.params()
params.all_params['deathRate'] = dilution_rate
params.all_params['metaboliteDilutionRate'] = dilution_rate
</code></pre>

<p>Let's also change a few other parameters.</p>
<pre><code class="Py">params.all_params['timeStep'] = 0.1
params.all_params[&quot;maxSpaceBiomass&quot;] = 10
params.all_params['maxCycles'] = 2000
</code></pre>

<p>Finally, lets keep track of just a few key metabolites: lactose and galactose. We do this using the specificMedia log, and choosing the metabolites with a comma-separated list with no spaces.</p>
<pre><code class="Py">params.all_params['writeSpecificMediaLog'] = True
params.all_params['specificMediaLogRate'] = 1
params.all_params['specificMedia'] = 'lcts_e,gal_e'
</code></pre>

<p>Now we can generate a COMETS simulation object, run it, then examine the biomass and metabolites.</p>
<pre><code class="Py">sim = c.comets(layout, params)
sim.run()
sim.total_biomass.plot(x = &quot;cycle&quot;)
# in the next line, we exclude the x and y columns, as this was not a spatial simulation
sim.specific_media.ix[:, sim.specific_media.columns.difference([&quot;x&quot;,&quot;y&quot;])].plot(x = &quot;cycle&quot;)
</code></pre>

<p>We see that both species survive, with LCTStex_KO cross-feeding galactose. The
metabolites, as is typical in chemostat, are in very low concentrations once
equilibrium is reached.</p>
<p>The above code required setting chemostat parameters in multiple places. We
offer this functionality so that researchers can create complex setups that
may, for example, have different initial concentrations than reservoir
concentrations, and different inflow rates than outflow rates. However, we
expect most chemostat simulations will function like above, where a single
dilution parameter dictates the behavior of the system. For this, we have
made a helper function which generates a layout and parameters file with the
correct setup:</p>
<pre><code class="Py"># here the first argument is a list of comets models, the second the reservoir media, and the third is the dilution rate
layout, params = c.chemostat([E_no_galE, E_no_LCTStex], comets_media, dilution_rate)

# we can then adjust other parameters as desired, and run.
params.all_params['timeStep'] = 0.1
params.all_params[&quot;maxSpaceBiomass&quot;] = 10
params.all_params['maxCycles'] = 2000
params.all_params['writeSpecificMediaLog'] = True
params.all_params['specificMediaLogRate'] = 1
params.all_params['specificMedia'] = 'lcts_e,gal_e'

sim = c.comets(layout, params)
sim.run()
sim.total_biomass.plot(x = &quot;cycle&quot;)
sim.specific_media.ix[:, sim.specific_media.columns.difference([&quot;x&quot;,&quot;y&quot;])].plot(x = &quot;cycle&quot;)
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../4_evolution/" class="btn btn-neutral float-right" title="Simulating evolution with COMETS">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../2_competition/" class="btn btn-neutral" title="Competition assay"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../2_competition/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../4_evolution/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/extra.js" defer></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="../../mathjax-config.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
